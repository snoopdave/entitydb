

#################################################### Start Prompt

# EntityDB software tools design

Assume the role of an experienced software architect.

You will design and implement a set of Typescript scripts for importing data into a database.

You are obsessed with completeness and you will never use the word "placeholder" or leave any code to be written later. 

## The system design

Each data entity will be of a variety of user-defined and named types.

Each type of data will be stored in a table named for the type, but pluralized. For example, entities of type "tweet" will be stored in a database table named "tweets".

Each table will stored a unique ID (a string), an entity_timestamp (a datetime) and a entity value stored as JSON. In the database table the fields should be id, timestamp and value. 

The unique ID will be taken from the source data entity and if the entity does not have an unique ID, then one will be generated by creating a hash of the source entity data.

The system will initially handle these types of data:
- My Tweets from data downloaded from my Instagram account
- My Facebook posts from data downloaded from my Facebook account
- My Instagram posts from data downloaded from my Instagram account

## Implementation requirements

* There must be a configuration file that specifies the location of the Facebook, Instagram and Tweet data downloads. 
  * The Twitter Tweet data file path is `data/twitter-backup-snoopdave-2022-11-23/data/tweets.js`
  * The Instagram posts data file path is `data/instagram-snoopdave-2023-11-19-kAjeAPiM/content/posts_1.json`
  * The Facebook posts data file path is `data/facebook-snoopdave-2023-11-19-WGJG0U7q/your_activity_across_facebook/posts/your_posts__check_ins__photos_and_videos_1.json` 

* The importers will each include code to parse the source data and convert it to Entities in the Postgres database. If a table does not exist yet for a type, it will be created.

* The Facebook importer will know how to parse Facebook post data, extract the JSON for each and insert it into the database table for the database type. The Facebook data file holds a JSON array of the Facebook posts.
  * For a Facebook entity, use a hash of the JSON object as the ID and the field "timestamp" (ms since the epoch) as the entity_timestamp, convert it from milliseconds.
 
* The Instagram importer will know how to parse Instagram post data, extract the JSON for each and insert it into the database table for the database type. The Instagram data file holds a JSON array of the Instagram posts.
  * For an Instagram entity, use the field "media.uri" as the ID and "media.creation_timestamp" (ms since the epoch) as the entity_timestamp, convert it from milliseconds.

* The Tweet importer will know how to parse Twitter tweet data, extract the JSON for each and insert it into the database table for the database type. Tweets are stored in JSON format in side a JavaScript file. A array variable named window.YTD.tweets.part0 contains the tweet objects. 
  * For a Tweet entity the, use a hash of the JSON object as the ID and the field "timestamp" (an  ISO 8601 string) as the entity_timestamp.

There will be an enum that defines the different types.

## Software architecture 

The software must be written in TypeScript and run on Node.js

The Tweet, Instagram and Facebook importers can be run via separate NPM commands.

Assume Postgres is running on localhost.

Use a Postgres client because we want to use the JSON capabilities of Postgres.

## Code generation requirements

The number of files in the project should be minimized.

Use strict Typescript mode and noImplicit any.

Where possibly, do all configurations in the package.json file not in separate files.


## Call to action 

First, list of the files to be generated in the project. Then list the complete source code of each file with no omissions, placeholders or parts to be completed later.

#################################################### End Prompt


## Subsequent prompts 

You forgot that "You are obsessed with completeness and you will never use the word 'placeholder' or leave any code to be written later."

Error message

    TS1192: Module '"fs"' has no default export.

Error message

    TSError: тип Unable to compile TypeScript:
    src/database-common.ts:1:22 - error TS7016: Could not find a declaration file for module 'pg'. '/Users/dave/src.sandbox/entitydb/node_modules/pg/lib/index.js' implicitly has an 'any' type.
    Try `npm i --save-dev @types/pg` if it exists or add a new declaration (.d.ts) file containing `declare module 'pg';`

    1 import { Pool } from 'pg';

In the Instagram Importer the field media is an array, take the first object in the array as the Instagram post.

In the Tweet importer, realize that window.YTD.tweets.part0 is a JavaScript variable. whose value is an array of Tweet objects. You can't just eval it.

The tweets.js file does not end with a ;

## Things to do later:

Write a set of Jest tests with sample data fixtures or mocks for each importer.

Create a README that explains the project and how to run it.